<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padaria Artesanal - PDV</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Meta tags para PWA -->
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Padaria PDV">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, viewport-fit=cover">

    <!-- Link para manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="android-launchericon-192-192.png">

    <!-- Para evitar zoom indesejado em inputs -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body>
    <div id="appContainer" class="container">
        <!-- Header com busca -->
        <header class="header">
            <div class="header-main-row">
                <!-- Botão menu hamburguer -->
                <button id="menuToggle" class="icon-btn" aria-label="Menu" title="Menu">
                    <i class="fas fa-bars"></i>
                </button>

                <!--<div class="logo">
                    <i class="fas fa-bread-slice"></i>
                    <h1>Padaria Artesanal</h1>
                </div>-->
                <div class="search-container">
                    <div class="search-input-wrapper">
                        <input type="text" id="searchInput" placeholder="Buscar produtos..." class="search-input">
                        <button class="clear-search-btn" id="clearSearchBtn" style="display: none;">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <button class="search-btn">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Menu lateral -->
        <aside id="sideMenu" class="side-menu" style="position:fixed; top:0; left:0; height:100vh; width:260px; background:#fff; box-shadow: 2px 0 12px rgba(0,0,0,0.1); transform: translateX(-100%); transition: transform .25s ease; z-index:2000;">
            <div style="display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid #eee;">
                <strong style="font-size:16px;">Menu</strong>
                <button id="menuClose" class="icon-btn" aria-label="Fechar" title="Fechar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav style="display:flex; flex-direction:column; padding:8px 6px;">
                <a href="sales.html" class="menu-link" style="padding:12px 14px; border-radius:8px; color:#333; text-decoration:none; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-chart-line"></i>
                    <span>Vendas</span>
                </a>
                <button id="menuExportJson" class="menu-link" style="padding:12px 14px; border-radius:8px; color:#333; text-align:left; background:none; border:none; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-download"></i>
                    <span>Baixar JSON</span>
                </button>
                <button id="menuClearCache" class="menu-link" style="padding:12px 14px; border-radius:8px; color:#333; text-align:left; background:none; border:none; display:flex; align-items:center; gap:10px;">
                    <i class="fas fa-broom"></i>
                    <span>Limpar cache</span>
                </button>
            </nav>
        </aside>

        <!-- Backdrop do menu -->
        <div id="menuBackdrop" style="position:fixed; inset:0; background:rgba(0,0,0,.25); backdrop-filter:saturate(120%) blur(1px); display:none; z-index:1999;"></div>

        <script>
        // Comportamento do menu lateral
        (function(){
            const sideMenu = document.getElementById('sideMenu');
            const backdrop = document.getElementById('menuBackdrop');
            const openBtn = document.getElementById('menuToggle');
            const closeBtn = document.getElementById('menuClose');
            const exportBtn = document.getElementById('menuExportJson');
            const clearBtn = document.getElementById('menuClearCache');

            function openMenu(){
                sideMenu.style.transform = 'translateX(0)';
                backdrop.style.display = 'block';
            }
            function closeMenu(){
                sideMenu.style.transform = 'translateX(-100%)';
                backdrop.style.display = 'none';
            }
            openBtn && openBtn.addEventListener('click', openMenu);
            closeBtn && closeBtn.addEventListener('click', closeMenu);
            backdrop && backdrop.addEventListener('click', closeMenu);

            // Ações
            exportBtn && exportBtn.addEventListener('click', function(){
                try {
                    if (typeof exportDataAsJSON === 'function') {
                        exportDataAsJSON();
                    } else {
                        // Fallback simples
                        const data = (typeof dataStore !== 'undefined' && dataStore.getData) ? dataStore.getData() : {};
                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                        const a = document.createElement('a');
                        a.href = URL.createObjectURL(blob);
                        a.download = 'padaria_pdv_data.json';
                        a.click();
                    }
                } catch(err){ console.error('Falha ao exportar JSON:', err); }
                closeMenu();
            });
            clearBtn && clearBtn.addEventListener('click', function(){
                try {
                    if (typeof clearSiteData === 'function') {
                        clearSiteData();
                    }
                } catch(err){ console.error('Falha ao limpar dados do site:', err); }
                closeMenu();
            });
        })();
        </script>

        <!-- Área principal -->
        <main class="main-content">
            <a href="#endCart" class="floating-arrow arrow-down">
                <i class="fa fa-arrow-down"></i>
            </a>
            <a href="#startCategory" class="floating-arrow arrow-up">
                <i class="fa fa-arrow-up"></i>
            </a>
            <!-- Categorias -->
            <section class="categories-section">
                <div class="categories-header">
                    <a name="startCategory"></a>
                    <h2>Categorias</h2>
                    <button class="add-category-btn" onclick="showAddCategoryModal()">
                        <i class="fas fa-plus"></i>
                        Nova Categoria
                    </button>
                </div>
                <div class="categories-grid" id="categoriesGrid">
                    <!-- Categorias serão inseridas via JavaScript -->
                </div>
            </section>

            <!-- Produtos em destaque -->
            <section class="products-section">
                <div class="products-header">
                    <h2>Produtos</h2>
                    <button class="add-product-btn" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i>
                        Novo Produto
                    </button>
                </div>
                <div class="products-grid" id="productsGrid">
                    <!-- Produtos serão inseridos via JavaScript -->
                </div>
            </section>
        </main>

        <!-- Footer com informações -->
        <footer class="footer">
            <div class="footer-info">
                <a name="endCart"></a>
                <div class="total-products">
                    <i class="fas fa-boxes"></i>
                    <span>Total de Produtos: <strong id="totalProducts">0</strong></span>
                </div>
                <div class="cart-total">
                    <i class="fas fa-shopping-bag"></i>
                    <span>Itens na Sacola: <strong id="cartItems">0</strong></span>
                </div>
                <div class="cart-value">
                    <i class="fas fa-dollar-sign"></i>
                    <span>Valor Total: <strong id="cartValue">R$ 0,00</strong></span>
                </div>
                <div class="saved-sales-list" id="savedSalesList" style="display: none;">
                    <h4>Vendas Salvas:</h4>
                    <div id="savedSalesContainer"></div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts - ordem importante! -->
    <!-- 1. Data store (persistência local) -->
    <script src="data-store.js"></script>
    
    <!-- 2. Autenticação -->
    <script src="auth.js"></script>
    
    <!-- 3. Script principal -->
    <script src="script.js"></script>
    
    <!-- 4. Service worker para PWA -->
    <script>
        // Register service worker only on supported origins (avoid errors on file:// or null origins)
        try {
            if ('serviceWorker' in navigator) {
                const canRegister = (location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname === '127.0.0.1');
                if (canRegister) {
                    window.addEventListener('load', function() {
                        navigator.serviceWorker.register('sw.js').catch(err => console.warn('ServiceWorker registration failed:', err));
                    });
                } else {
                    console.warn('ServiceWorker not registered: unsupported origin/protocol', location.protocol, location.hostname);
                }
            }
        } catch (err) {
            console.warn('ServiceWorker registration skipped due to error:', err);
        }
    </script>
</body>
</html>
