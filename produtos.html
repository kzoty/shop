<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Lista de Produtos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
    .container { max-width: 1200px; margin: 0 auto; }
    h1 { color: #333; text-align: center; margin-bottom: 30px; }
    
    .debug { background: #f0f0f0; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #ddd; }
    .error { background: #ffe6e6; color: #d32f2f; border-left-color: #d32f2f; }
    .success { background: #e8f5e8; color: #2e7d32; border-left-color: #2e7d32; }
    .info { background: #e3f2fd; color: #1976d2; border-left-color: #1976d2; }
    
    .products-grid { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); 
      gap: 20px; 
      margin-top: 20px; 
    }
    
    .product-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid #e0e0e0;
    }
    
    .product-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .product-header {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }
    
    .product-icon {
      font-size: 2rem;
      margin-right: 15px;
      color: #667eea;
      width: 50px;
      text-align: center;
    }
    
    .product-info h3 {
      margin: 0 0 5px 0;
      color: #333;
      font-size: 1.2rem;
    }
    
    .product-id {
      color: #666;
      font-size: 0.9rem;
      font-weight: bold;
    }
    
    .product-details {
      color: #555;
      line-height: 1.5;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
      font-size: 1.1rem;
    }
    
    .error-message {
      text-align: center;
      padding: 40px;
      color: #d32f2f;
      font-size: 1.1rem;
      background: #ffe6e6;
      border-radius: 8px;
      margin: 20px 0;
    }
    
    .stats {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    
    .stats h3 {
      margin: 0 0 10px 0;
      color: #333;
    }
    
    .stats p {
      margin: 5px 0;
      color: #666;
      font-size: 1.1rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üì¶ Lista de Produtos</h1>
    
    <div id="debugInfo" class="debug">
      <h3>üîç Informa√ß√µes de Debug:</h3>
      <div id="connectionStatus">Verificando conex√£o...</div>
      <div id="tableInfo">Verificando tabela...</div>
    </div>
    
    <div id="stats" class="stats" style="display: none;">
      <h3>üìä Estat√≠sticas</h3>
      <p>Total de produtos: <span id="totalProducts">0</span></p>
      <p>√öltima atualiza√ß√£o: <span id="lastUpdate">-</span></p>
    </div>
    
    <div id="productsContainer">
      <div class="loading">Carregando produtos...</div>
    </div>
  </div>

  <!-- SDK Supabase via CDN -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm"

    // Configura√ß√µes de conex√£o (mesmas do testhtml.html)
    const supabaseUrl = 'https://nqplihfmbwlrbyzbxilh.supabase.co'
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5xcGxpaGZtYndscmJ5emJ4aWxoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMjEzODQsImV4cCI6MjA3MTg5NzM4NH0.mn_2tyTloRpvUxPmyU7jWt1YYSa7Y3FRFGe0B4nGXSA'
    const supabase = createClient(supabaseUrl, supabaseKey)

    // Fun√ß√£o para atualizar informa√ß√µes de debug
    function updateDebugInfo(elementId, message, type = 'info') {
      const element = document.getElementById(elementId)
      element.textContent = message
      element.className = `debug ${type}`
    }

    // Fun√ß√£o para testar a conex√£o
    async function testConnection() {
      try {
        updateDebugInfo('connectionStatus', 'Testando conex√£o...', 'info')
        
        // Teste simples de conex√£o
        const { data, error } = await supabase
          .from('categories')
          .select('count')
          .limit(1)
        
        if (error) {
          updateDebugInfo('connectionStatus', `‚ùå Erro na conex√£o: ${error.message}`, 'error')
          return false
        } else {
          updateDebugInfo('connectionStatus', '‚úÖ Conex√£o estabelecida com sucesso!', 'success')
          return true
        }
      } catch (err) {
        updateDebugInfo('connectionStatus', `‚ùå Erro inesperado: ${err.message}`, 'error')
        return false
      }
    }

    // Fun√ß√£o para verificar informa√ß√µes da tabela
    async function checkTableInfo() {
      try {
        updateDebugInfo('tableInfo', 'Verificando estrutura da tabela...', 'info')
        
        // Tentar diferentes abordagens para verificar a tabela
        const { data, error } = await supabase
          .from('categories')
          .select('*')
          .limit(5)
        
        if (error) {
          updateDebugInfo('tableInfo', `‚ùå Erro ao acessar tabela: ${error.message}`, 'error')
          
          // Tentar verificar se a tabela existe com uma consulta mais simples
          const { data2, error2 } = await supabase
            .from('categories')
            .select('id')
            .limit(1)
          
          if (error2) {
            updateDebugInfo('tableInfo', `‚ùå Tabela 'categories' n√£o encontrada ou sem permiss√£o: ${error2.message}`, 'error')
          }
        } else {
          updateDebugInfo('tableInfo', `‚úÖ Tabela encontrada! Registros retornados: ${data ? data.length : 0}`, 'success')
          console.log('Dados retornados:', data)
        }
      } catch (err) {
        updateDebugInfo('tableInfo', `‚ùå Erro ao verificar tabela: ${err.message}`, 'error')
      }
    }

    // Fun√ß√£o para carregar todos os produtos
    async function loadProducts() {
      const productsContainer = document.getElementById('productsContainer')
      const statsDiv = document.getElementById('stats')
      
      try {
        console.log('Iniciando consulta √† tabela categories...')
        
        // Buscar TODOS os registros da tabela categories
        const { data, error } = await supabase
          .from("categories")
          .select("*") // Seleciona todas as colunas
          .order("id", { ascending: true })

        console.log('Resposta da consulta:', { data, error })

        if (error) {
          productsContainer.innerHTML = `<div class="error-message">‚ùå Erro na consulta: ${error.message}</div>`
          console.error('Erro na consulta:', error)
          return
        }

        if (!data || data.length === 0) {
          productsContainer.innerHTML = `<div class="error-message">Nenhum produto encontrado na tabela categories</div>`
          console.log('Nenhum dado retornado da consulta')
          return
        }

        // Mostrar estat√≠sticas
        statsDiv.style.display = 'block'
        document.getElementById('totalProducts').textContent = data.length
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('pt-BR')

        // Renderizar produtos em cards
        productsContainer.innerHTML = ""
        
        data.forEach(product => {
          const productCard = document.createElement('div')
          productCard.className = 'product-card'
          
          // Criar o card com todas as informa√ß√µes dispon√≠veis
          productCard.innerHTML = `
            <div class="product-header">
              <div class="product-icon">
                ${product.icon || 'üì¶'}
              </div>
              <div class="product-info">
                <h3>${product.name || 'Sem nome'}</h3>
                <div class="product-id">ID: ${product.id}</div>
              </div>
            </div>
            <div class="product-details">
              ${Object.entries(product)
                .filter(([key, value]) => key !== 'id' && key !== 'name' && key !== 'icon' && value !== null)
                .map(([key, value]) => `<p><strong>${key}:</strong> ${value}</p>`)
                .join('')}
            </div>
          `
          
          productsContainer.appendChild(productCard)
        })
        
        console.log(`Renderizados ${data.length} produtos`)
        
        // Log detalhado de cada produto para debug
        data.forEach((product, index) => {
          console.log(`Produto ${index + 1}:`, product)
        })
        
      } catch (err) {
        productsContainer.innerHTML = `<div class="error-message">‚ùå Erro inesperado: ${err.message}</div>`
        console.error('Erro inesperado:', err)
      }
    }

    // Executar testes e carregar dados
    async function init() {
      console.log('Iniciando aplica√ß√£o de produtos...')
      
      // Testar conex√£o primeiro
      const connectionOk = await testConnection()
      
      if (connectionOk) {
        // Verificar informa√ß√µes da tabela
        await checkTableInfo()
        
        // Carregar produtos
        await loadProducts()
      }
    }

    // Inicializar quando a p√°gina carregar
    init()
  </script>
</body>
</html>
